<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Babylon Template</title>

    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>

    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
</head>

<body>

    <canvas id="renderCanvas" touch-action="none"></canvas>

    <script>
        const canvas = document.getElementById("renderCanvas"); // Recoge el canvas con su ID
        const engine = new BABYLON.Engine(canvas, true); // Genera el motor 3D de Babylon JS

        const createScene = function () {

            const scene = new BABYLON.Scene(engine);
            const camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 2.5, 5, new BABYLON.Vector3(10, 5, -5));
            camera.attachControl(canvas, false);
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 0, 0));
            //AÃ‘ADIMOS SONIDO AMBIENTAL
            //const sound = new BABYLON.Sound("futbol", "./sources/audiofutbol.mp3", scene, null, { loop: true, autoplay: true });
            //CREAMOS EL SUELO
            const ground = BABYLON.Mesh.CreateGround("ground1", 100, 100, 0, scene);
            var materialGround = new BABYLON.StandardMaterial("materialGround", scene);
            materialGround.diffuseTexture = new BABYLON.Texture("./sources/images/ground.jpg", scene);
            ground.material = materialGround;

            //CREAMOS EL CIELO DEL ESCENARIO
            // Skybox
            var skybox = BABYLON.MeshBuilder.CreateBox("skyBox", { size: 100.0 }, scene);
            var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
            skyboxMaterial.backFaceCulling = false;
            var files = [
                "./sources/images/skybox/skybox_nx.jpg",
                "./sources/images/skybox/skybox_ny.jpg",
                "./sources/images/skybox/skybox_nz.jpg",
                "./sources/images/skybox/skybox_px.jpg",
                "./sources/images/skybox/skybox_py.jpg",
                "./sources/images/skybox/skybox_pz.jpg",
            ];
            skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture.CreateFromImages(files, scene);
            skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
            skyboxMaterial.disableLighting = true;
            skybox.material = skyboxMaterial;


            const coche = BABYLON.SceneLoader.ImportMeshAsync("", "sources/", "coche.obj", scene);
            //CENTRAR LA VISTA EN EL COCHE
            coche.then((result) => {
                camera.target = result.meshes[0];
            });

            // PRUEBAS //////////////////////////////////////

            //Position Animation
            var box = BABYLON.MeshBuilder.CreateBox("box", {size: 5}, scene);
            box.position.x = -10;
            
            var xSlide = new BABYLON.Animation("xSlide", "position.z", 5, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);
            var keyFramesP = [];
            keyFramesP.push({
                frame: 0,
                value: 2
            });
           
            keyFramesP.push({
                frame: 4 * 5,
                value: 80
            });

            xSlide.setKeys(keyFramesP);

            scene.beginDirectAnimation(box, [xSlide], 0, 2 * 5, true);
            /////////////////////////////////////////////////
            // GUI
           
            return scene;
        };

        const scene = createScene(); //Call the createScene function

        // Register a render loop to repeatedly render the scene
        engine.runRenderLoop(function () {
            scene.render();
        });

        // Watch for browser/canvas resize events
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>

</body>

</html>